<!DOCTYPE html>
<html>
<head>
  <title>Fix Broken Images - MT Kenya News</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
    button { padding: 15px 30px; font-size: 18px; cursor: pointer; margin: 10px; }
    .success { color: green; }
    .error { color: red; }
    pre { background: #f5f5f5; padding: 15px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>ðŸ”§ Fix Broken Image URLs</h1>
  <p>This will replace all localhost image URLs with placeholder images so articles can load.</p>
  
  <button onclick="checkImages()">1. Check Broken Images</button>
  <button onclick="fixImages()">2. Fix Images</button>
  
  <div id="result"></div>

  <script>
    const API = 'https://mtkenyanews.com';
    let token = null;

    async function login() {
      const res = await fetch(`${API}/api/admin/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username: 'admin', password: 'Mtkenya@2025' })
      });
      const data = await res.json();
      token = data.token;
      return token;
    }

    async function checkImages() {
      document.getElementById('result').innerHTML = 'Checking...';
      try {
        await login();
        const res = await fetch(`${API}/api/fix-images`, {
          method: 'POST',
          headers: { Authorization: `Bearer ${token}` }
        });
        const data = await res.json();
        document.getElementById('result').innerHTML = `
          <h2>Found Broken Images:</h2>
          <pre>${JSON.stringify(data, null, 2)}</pre>
        `;
      } catch (err) {
        document.getElementById('result').innerHTML = `<p class="error">Error: ${err.message}</p>`;
      }
    }

    async function fixImages() {
      document.getElementById('result').innerHTML = 'Fixing...';
      try {
        await login();
        const res = await fetch(`${API}/api/fix-images-auto`, {
          method: 'POST',
          headers: { Authorization: `Bearer ${token}` }
        });
        const data = await res.json();
        document.getElementById('result').innerHTML = `
          <h2 class="success">âœ… Fixed!</h2>
          <pre>${JSON.stringify(data, null, 2)}</pre>
          <p><a href="https://mtkenyanews.com" target="_blank">Go to website â†’</a></p>
        `;
      } catch (err) {
        document.getElementById('result').innerHTML = `<p class="error">Error: ${err.message}</p>`;
      }
    }
  </script>
</body>
</html>
